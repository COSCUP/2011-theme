"use stricts";jQuery(function(t){var e,o=(t("html").attr("lang")||"zh-TW").toLowerCase();function n(){return!t("#title:visible").length}function i(){var e=[];t("#mobileSponsorLogo").remove(),t.each({diamond:10,gold:5,silver:2,bronze:1},function(o,n){t("#sidebar > .sponsors ."+o+" a").each(function(){for(var t=n;t--;)e.push(this)})}),0!==e.length&&t("#nav").after(t('<p id="mobileSponsorLogo" />').append(t(e[Math.floor(e.length*Math.random())]).clone()))}function a(){t("#sidebar2 > .images").imageTile({num:12,photos:yuren_54,beforeImageLoad:function(t,e){t.css("opacity",0)},imageLoad:function(t,e){t.css("opacity",1)}})}function r(){t("#sidebar2 > .images").length&&(t.fn.imageTile?a():t.ajax({url:"http://coscup.org/2011-theme/assets/imagetile.min.js",dataType:"script",cache:!0,success:a})),t("#countdown-time").length&&(e=setInterval(v,1e3),t(window).bind("pageload",function(o){clearTimeout(e),t(window).unbind(o)}),v(),t("#countdown").addClass("show"))}function l(){t(window).trigger("pageload"),t("#header").css("background-position","center -"+(75*Math.floor(4*Math.random())).toString(10)+"px"),t("#footer").css("background-position","center -"+(75*Math.floor(6*Math.random())).toString(10)+"px"),n()?(window._gaq&&_gaq.push(["_trackEvent","Mobile 2011",window.location.href]),t(window).bind("resize.defer",function(){n()||(t(this).unbind("resize.defer"),r(),t("#sidebar2 iframe").each(function(){t(this).attr("data-src")&&(this.src=t(this).attr("data-src"))}))}),t(".hideInMobile iframe").each(function(){t(this).attr("data-src",this.src),this.src=""})):(r(),window.history&&history.pushState&&t("a").each(function(){this.hostname===window.location.hostname&&/2011/.test(this.pathname)&&new RegExp(o).test(this.pathname.toLowerCase())&&this.href!==window.location.href&&!h[this.href]&&"fetching"!==h[this.href]&&!/nocache/.test(this.getAttribute("rel"))&&(p.push(this.href),h[this.href]="fetching",1===p.length&&function e(){var o=p.shift();t.ajax({url:o,dataType:"html",cache:!0,complete:function(t,n){"success"!==n&&"notmodified"!==n||(h[o]=t.responseText),0!==p.length&&e()}})}())}))}t("#nav.empty").length&&t.getJSON("/2011/api/menu.json",function(e){t("#nav").removeClass("empty").html(e[o].replace(/href="(\/[^\/])/g,'href="http://coscup.org$1')),t('#nav a[href*="'+window.location.hostname+'"]').parent().addClass("current")}),t(window).bind("pageload",i),t(window).bind("pageload",function(){if(t(".shortcuts")&&!((new Date).getTime()>parseInt(t(".program tbody th:last").attr("rel")+"000",10))){var e=t('<a href="#" />').text({"zh-tw":"目前議程","zh-cn":"目前议程",en:"Current Session"}[o]);e.bind("click",function(e){var o,n=(new Date).getTime();e.stopPropagation(),e.preventDefault(),t(".program tbody th").each(function(e,i){var a=parseInt(t(i).attr("rel")+"000",10);if(n<a&&o)return t(document.body).animate({scrollTop:t(o).offset().top-20},180),t(window).trigger("scroll"),!1;n>a&&(o=i)}),o||(t(document.body).animate({scrollTop:t(".program tbody th:first").offset().top-20},180),t(window).trigger("scroll"))}),t(".shortcuts").append(t('<li class="fullwidth" />').append(e)),t(".shortcuts").after('<a class="mobile_top" href="#"></a>');var n,i=t(".mobile_top");i.bind("click",function(){return t(window).trigger("scroll"),t(document.body).animate({scrollTop:t(".shortcuts").offset().top-20},180),!1}),t(window).bind("resize.mt scroll.mt",function(){i.removeClass("show"),clearTimeout(n),n=setTimeout(function(){t(".shortcuts").offset().top<t(document.body).scrollTop()&&i.css("top",t(document.body).scrollTop()+(window.innerHeight||t(window).height())-i.height()-15).addClass("show")},200)}),t(window).bind("pageload",function(e){clearTimeout(n),t(window).unbind("resize.mt scroll.mt").unbind(e)})}}),t("#sidebar > .sponsors.empty").length&&t.getJSON("/2011/api/sponsors.json",function(e){var n=t("#sidebar > .sponsors").removeClass("empty"),a={en:{diamond:"Diamond Level Sponsors",gold:"Gold Level Sponsors",silver:"Silver Level Sponsors",bronze:"Bronze Level Sponsors",media:"Media Partners"},"zh-tw":{diamond:"鑽石級贊助",gold:"黃金級贊助",silver:"白銀級贊助",bronze:"青銅級贊助",media:"媒體夥伴"},"zh-cn":{diamond:"钻石级赞助",gold:"黄金级赞助",silver:"白银级赞助",bronze:"青铜级赞助",media:"媒体伙伴"}}[o];t.each(["diamond","gold","silver","bronze","media"],function(i,s){if(e[s]){n.append("<h2>"+a[s]+"</h2>");var r=t('<ul class="'+s+'" />');t.each(e[s],function(t,e){r.append('<li><a href="'+e.url+'" target="_blank"><img title="'+e.name[o]+'" src="'+e.logoUrl+'" /></a></li>')}),n.append(r)}}),i()}),t(".sponsors a, #mobileSponsorLogo a").live("click",function(){return window._gaq&&_gaq.push(["_trackEvent","Sponsors 2011",this.href]),!0}),t("#mobileSponsorLogo a").live("click",function(){return window._gaq&&_gaq.push(["_trackEvent","Sponsors 2011 (Mobile only)",this.href]),!0}),t(".shortcuts a").live("click",function(e){t(window).trigger("scroll"),e.preventDefault(),t(document.body).animate({scrollTop:t(this.hash).offset().top-20},180)}),t("#nav > ul > li").bind("touchstart",function(){var e=t(this);e.addClass("selected"),t(document.body).bind("touchend",function(o){e.removeClass("selected"),t(this).unbind(o)})}),t(".socialbuzz a").live("click",function(){return window.open(this.href),!1});var c,d,h={},p=[];function u(e,o,n){if(t(window).unbind("resize.defer"),c&&c.abort(),!o&&h[e]&&"fetching"!==h[e])n&&t(window).scrollTop(0),f(h[e]);else{var i=t("#content").addClass("loading");c=t.ajax({url:e,dataType:"html",cache:!o,complete:function(o,a){"success"===a||"notmodified"===a?(i.removeClass("loading"),h[e]=o.responseText,n&&t(window).scrollTop(0),f(o.responseText)):window.location.replace(e)}})}}function f(e){var o=t("<div />").append(e.match(/<body\b([^\u0000]+)<\/body>/)[0].replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""));document.title=e.match(/<title>(.+)<\/title>/)[1],t("#content").html(o.find("#content").children()).removeClass("loading"),o.find("#nav").is(".empty")||t("#nav").html(o.find("#nav").children()),window._gaq&&_gaq.push(["_trackPageview"]),l()}if(l(),window.history&&history.pushState){var m="state"in window.history,w=location.href;t("a").live("click",function(e){if(2==e.which||e.metaKey)return!0;if(this.hostname!==window.location.hostname||!/2011/.test(this.pathname)||!new RegExp(o).test(this.pathname.toLowerCase())||"#"===this.getAttribute("href").substr(0,1)||/nocache/.test(this.getAttribute("rel")))return!0;t(this).parent("#nav li").addClass("loading");var n=this.href,i=this.href===window.location.href;return history.pushState({is:"pushed"},"",n),u(n,i,!0),m=!0,!1}),window.onpopstate=function(t){var e=!m&&location.href==w;m=!0,e||u(window.location.href,!1,!1)}}function g(){if(d){var e,i=function(){var e={};return t(".types li").each(function(o,n){e[(o+1).toString(10)]=t(this).text()}),e}();t.fn.translateTo=function(t){return t?(t+=10,this.addClass("translate").css({"-webkit-transform":"translateX("+t.toString(10)+"px)","-moz-transform":"translateX("+t.toString(10)+"px)","-ms-transform":"translateX("+t.toString(10)+"px)",transform:"translateX("+t.toString(10)+"px)"})):this.removeClass("translate").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"",transform:""})},t("table.program").each(function(){var o=t(this);o.prev().after(t('<div class="program" />').append(o).bind("scroll",function(){var o=t(this);o.find("thead th:first, tbody th").translateTo(0),clearTimeout(e),e=setTimeout(function(){o.find("thead th:first, tbody th").translateTo(o.scrollLeft())},200)}).bind("touchstart",function(e){var o=t(this),i=t(window),a=e.clientX||e.originalEvent.touches[0].clientX,s=e.clientY||e.originalEvent.touches[0].clientY;o.hasClass("expend")&&!n()&&(o.addClass("movestart"),i.bind("touchmove",function(t){o.removeClass("movestart").addClass("moving").scrollLeft(o.scrollLeft()+a-(t.clientX||t.originalEvent.touches[0].clientX)),"touchmove"!==t.type&&i.scrollTop(i.scrollTop()+s-(t.clientY||t.originalEvent.touches[0].clientY)),a=t.clientX||t.originalEvent.touches[0].clientX,s=t.clientY||t.originalEvent.touches[0].clientY}).bind("touchend",function(t){return i.unbind("touchmove touchend"),setTimeout(function(){o.removeClass("moving movestart")},0),!1}))}))}),t("table.program td").each(function(){var e=t(this),n=d[e.data("pid")];if(n)if(0!==n.type){var a=t('<ul class="meta" />'),s=(c=t('<ul class="meta" />'),{en:"English",zh:"漢語"}[(this.className.match(/program_lang_(\w+)\b/)||[])[1]]),r=i[(this.className.match(/program_type_(\w+)\b/)||[])[1]];if(s&&a.append(t("<li />").text(s)),r&&a.append(t("<li />").text(r)),n.slide){h=t('<li><a href="'+n.slide+'">'+{en:"Slide","zh-tw":"投影片","zh-cn":"投影片"}[o||"en"]+"</a></li>");c.append(h),a.append(h.clone())}if(n.youtube){f="http://www.youtube.com/embed/"+(p=[].concat(n.youtube)).shift()+"?hd=1";n.youtube.length&&(f+="&playlist="+p.join(",")),u=t('<li><a href="'+f+'" class="youtube_video">'+{en:"Video","zh-tw":"演講錄影","zh-cn":"演讲录影"}[o||"en"]+"</a></li>"),c.append(u),a.append(u.clone())}var l=t('<div class="info" />');a.children().length&&l.append(a),n.abstract&&l.append(t('<div class="abstract" />').html(n.abstract)),n.bio&&l.append(t('<div class="bio" />').html(n.bio)),c.children().length&&e.append(c),l.children().length&&e.append(l)}else{var c=t('<ul class="meta" />');if(n.slide){var h=t('<li><a href="'+n.slide+'">'+{en:"Slide","zh-tw":"投影片","zh-cn":"投影片"}[o||"en"]+"</a></li>");c.append(h)}if(n.youtube){var p,u,f="http://www.youtube.com/embed/"+(p=[].concat(n.youtube)).shift()+"?hd=1";n.youtube.length&&(f+="&playlist="+p.join(",")),u=t('<li><a href="'+f+'" class="youtube_video">'+{en:"Video","zh-tw":"演講錄影","zh-cn":"演讲录影"}[o||"en"]+"</a></li>"),c.append(u)}c.children().length&&e.append(c)}}).bind("click",function(){var e=t(this),o=e.parents("div.program"),n=parseInt((this.className.match(/program_room_(\w+)\b/)||[])[1]),i=t(window).scrollTop()-e.offset().top;if(o.hasClass("moving"))return!1;switch(window._gaq&&_gaq.push(["_trackEvent","Program 2011",this.hash]),t(this).toggleClass("expend"),o.toggleClass("expend"),o.find("thead th:first, tbody th").translateTo(o.scrollLeft()),n){case 0:o.scrollLeft(.26*o[0].scrollWidth);break;case 1:o.scrollLeft(0);break;case 2:o.scrollLeft(.13*o[0].scrollWidth);break;case 3:o.scrollLeft(.38*o[0].scrollWidth);break;case 4:o.scrollLeft(o[0].scrollWidth)}t(window).scrollTop(e.offset().top+i)}),t(".program p.name a").bind("click",function(t){if(2==t.which||t.metaKey)return!0;t.preventDefault()}),t(".program .meta a, .program .info a").bind("click",function(e){if(2==e.which||e.metaKey)return!0;if(t(this).hasClass("youtube_video")&&!n()){if(t(document.body).append('<div id="video_modal" class="video_box" />').append('<iframe id="video_iframe" class="video_box" title="YouTube video player" width="854" height="483"  src="'+this.href+'" frameborder="0"  allowfullscreen="allowfullscreen"></iframe>').append('<div id="video_close_button" class="video_box" />'),0===t("#video_modal").offset().top){t(".video_box").css("position","absolute");var o=function(){t("#video_modal").css({top:0,left:0,width:document.body.scrollWidth,height:document.body.scrollHeight}),t("#video_iframe, #video_close_button").css({top:t(window).scrollTop()+(window.innerHeight||t(window).height())/2,left:t(window).scrollLeft()+(window.innerWidth||t(window).width())/2})};o(),t(window).bind("scroll.repositionvideo resize.repositionvideo",o).bind("pageload.repositionvideo",function(e){t(window).unbind("scroll.repositionvideo resize.repositionvideo").unbind(e)})}}else window.open(this.href);e.preventDefault(),e.stopPropagation()})}}function v(){var n=1310731200-Math.floor((new Date).getTime()/1e3);n<0&&(clearTimeout(e),t("#countdown").html({en:'<a href="http://registrano.com/events/coscup2011-regist?locale=en">Register Now!</a>',"zh-tw":'<a href="http://registrano.com/events/coscup2011-regist">立刻報名！</a>',"zh-cn":'<a href="http://registrano.com/events/coscup2011-regist">立刻报名！</a>'}[o])),s=[],s[0]=(n%60).toString(10)+{en:" seconds","zh-cn":" 秒","zh-tw":" 秒"}[o],n=Math.floor(n/60),s[1]=(n%60).toString(10)+{en:" minutes ","zh-cn":" 分 ","zh-tw":" 分 "}[o],n=Math.floor(n/60),s[2]=(n%24).toString(10)+{en:" hours ","zh-cn":" 时 ","zh-tw":" 時 "}[o],(n=Math.floor(n/24))&&(s[3]=n.toString(10)+{en:" days ","zh-cn":" 天 ","zh-tw":" 天 "}[o]),t("#countdown-time").text(s.reverse().join(""))}t(window).bind("pageload",g),t("#video_modal, #video_close_button").live("click",function(){t(".video_box").remove(),t(window).unbind("scroll.repositionvideo resize.repositionvideo pageload.repositionvideo")}),/((blog|sponsor|register)\.)?coscup\.org\.?/.test(window.location.domain)||t.getJSON("/2011/api/program.json",function(t){d=t,g()})});
